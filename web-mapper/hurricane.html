<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>After the Surge: EV Charging Stations & Hurricane Ian (2022)</title>

<meta name="description" content="A dystopian web map showing EV charging stations impacted by Hurricane Ian's 30-mile storm corridor in 2022."/>
<meta name="keywords" content="web map,dystopian,EV charging,hurricane,buffer,interactive map"/>

<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link
  rel="stylesheet"
  href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
/>

<style>
html, body, #map {
  height: 100%;
  margin: 0;
  background: #000;
  font-family: system-ui, sans-serif;
}

/* UI panels */
.panel {
  position: absolute;
  background: rgba(10,10,10,0.85);
  color: #ddd;
  padding: 12px;
  border-radius: 8px;
  z-index: 1000;
}

#filters {
  top: 20px;
  left: 20px;
}

.legend {
  bottom: 20px;
  left: 20px;
  font-size: 13px;
}

/* Pulsing EV symbols */
.ev-pulse {
  fill: #ffd400;
  animation: pulse 2s infinite;
  opacity: 0.85;
}

@keyframes pulse {
  0% { r: 4; opacity: 0.3; }
  50% { r: 9; opacity: 1; }
  100% { r: 4; opacity: 0.3; }
}

/* Fast charger glow */
.fast-ring {
  stroke: #ffea00;
  stroke-width: 2;
  fill: none;
  filter: drop-shadow(0 0 6px #ffea00);
}
</style>
</head>

<body>
<div id="map"></div>

<div id="filters" class="panel">
  <strong>EV Networks</strong><br/>
  <label><input type="checkbox" checked data-network="Tesla"> Tesla</label><br/>
  <label><input type="checkbox" checked data-network="ChargePoint"> ChargePoint</label><br/>
  <label><input type="checkbox" checked data-network="Electrify America"> Electrify America</label>
</div>

<div class="panel legend">
  <strong>Legend</strong><br/>
  ðŸ”´ Hurricane Ian Track<br/>
  ðŸ©¸ 30-mile Impact Zone<br/>
  ðŸŸ¡ EV Station (pulse = vulnerability)<br/>
  â­• Fast Chargers Present
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/@turf/turf@6/turf.min.js"></script>

<script>
// --------------------------------------------
// MAP SETUP
// --------------------------------------------
const map = L.map('map', {
  zoomControl: false,
  minZoom: 5,
  maxZoom: 10
}).setView([27.5, -82.5], 6);

L.tileLayer(
  'https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png',
  {
    attribution: 'Â© Carto | Web Mapper GPT'
  }
).addTo(map);

// --------------------------------------------
// HURRICANE IAN TRACK (SIMPLIFIED SAMPLE)
// Replace with full NOAA GeoJSON if desired
// --------------------------------------------
const hurricaneTrack = {
  "type": "Feature",
  "geometry": {
    "type": "LineString",
    "coordinates": [
      [-84.5, 22.3],
      [-83.9, 23.5],
      [-83.2, 25.0],
      [-82.6, 26.5],
      [-82.3, 27.8],
      [-81.9, 28.8]
    ]
  }
};

const trackLayer = L.geoJSON(hurricaneTrack, {
  style: {
    color: "#b30000",
    weight: 4
  }
}).addTo(map);

// 30 mile buffer
const buffer = turf.buffer(hurricaneTrack, 48.28, { units: 'kilometers' });

L.geoJSON(buffer, {
  style: {
    color: "#660000",
    weight: 0,
    fillOpacity: 0.25
  }
}).addTo(map);

// --------------------------------------------
// EV STATIONS (SIMULATED SAMPLE DATA)
// Replace with Open Charge Map API fetch
// --------------------------------------------
const evStations = [
  {
    name: "Tesla Supercharger",
    network: "Tesla",
    chargers: 12,
    fast: true,
    coords: [27.95, -82.46]
  },
  {
    name: "ChargePoint Station",
    network: "ChargePoint",
    chargers: 4,
    fast: false,
    coords: [26.7, -81.9]
  },
  {
    name: "Electrify America",
    network: "Electrify America",
    chargers: 6,
    fast: true,
    coords: [28.3, -81.6]
  }
];

const evLayer = L.layerGroup().addTo(map);

function drawStations() {
  evLayer.clearLayers();

  const activeNetworks = [...document.querySelectorAll('#filters input:checked')]
    .map(cb => cb.dataset.network);

  evStations.forEach(s => {
    if (!activeNetworks.includes(s.network)) return;

    const svg = `
      <svg width="30" height="30" viewBox="0 0 30 30">
        <circle class="ev-pulse" cx="15" cy="15" r="${4 + s.chargers}" />
        ${s.fast ? `<circle class="fast-ring" cx="15" cy="15" r="${6 + s.chargers}" />` : ''}
      </svg>
    `;

    const icon = L.divIcon({
      html: svg,
      className: '',
      iconSize: [30,30]
    });

    L.marker(s.coords, { icon })
      .bindPopup(`
        <strong>${s.name}</strong><br/>
        Network: ${s.network}<br/>
        Chargers: ${s.chargers}<br/>
        Fast Charging: ${s.fast ? 'Yes' : 'No'}
      `)
      .addTo(evLayer);
  });
}

drawStations();

// --------------------------------------------
// FILTER HANDLING
// --------------------------------------------
document.querySelectorAll('#filters input')
  .forEach(cb => cb.addEventListener('change', drawStations));
</script>
</body>
</html>
